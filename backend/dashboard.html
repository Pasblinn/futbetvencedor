<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öΩ Football Analytics Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .prediction-form {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: end;
        }

        .form-group {
            flex: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .results {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }

        .prediction-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .prediction-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .probability-bar {
            background: #e1e5e9;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recommendation-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e1e5e9;
            transition: border-color 0.3s;
        }

        .recommendation-card:hover {
            border-color: #667eea;
        }

        .confidence-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .confidence-low {
            background: #fed7d7;
            color: #c53030;
        }

        .confidence-medium {
            background: #fef5e7;
            color: #d69e2e;
        }

        .confidence-high {
            background: #c6f6d5;
            color: #38a169;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öΩ Football Analytics Dashboard</h1>
            <p>Sistema avan√ßado de predi√ß√µes matem√°ticas e Machine Learning</p>
        </div>

        <div class="prediction-form">
            <h2>üîÆ Gerar Predi√ß√£o</h2>
            <form id="predictionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="homeTeam">Time Mandante (ID)</label>
                        <input type="number" id="homeTeam" value="64" placeholder="Ex: 64 (Manchester United)">
                    </div>
                    <div class="form-group">
                        <label for="awayTeam">Time Visitante (ID)</label>
                        <input type="number" id="awayTeam" value="65" placeholder="Ex: 65 (Manchester City)">
                    </div>
                    <div class="form-group">
                        <label for="venue">Est√°dio (Opcional)</label>
                        <input type="text" id="venue" placeholder="Ex: Old Trafford">
                    </div>
                    <button type="submit" class="btn">üß† Predi√ß√£o Matem√°tica</button>
                    <button type="button" class="btn" onclick="getMLPrediction()">ü§ñ Predi√ß√£o ML</button>
                </div>
            </form>
        </div>

        <div class="results" id="results">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analisando dados e gerando predi√ß√µes...</p>
            </div>
            <div id="predictionResults"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';

        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            getMathematicalPrediction();
        });

        async function getMathematicalPrediction() {
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const venue = document.getElementById('venue').value;

            showLoading();

            try {
                const venueParam = venue ? `?venue=${encodeURIComponent(venue)}` : '';
                const response = await fetch(`${API_BASE}/predictions/test-live-engine/${homeTeam}/${awayTeam}${venueParam}`, {
                    method: 'POST'
                });

                const data = await response.json();
                displayPredictionResults(data, 'Matem√°tica');
            } catch (error) {
                showError('Erro ao buscar predi√ß√£o matem√°tica: ' + error.message);
            }
        }

        async function getMLPrediction() {
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;

            showLoading();

            try {
                const response = await fetch(`${API_BASE}/ml/enhanced-prediction/${homeTeam}/${awayTeam}`, {
                    method: 'POST'
                });

                const data = await response.json();
                displayMLResults(data);
            } catch (error) {
                showError('Erro ao buscar predi√ß√£o ML: ' + error.message);
            }
        }

        function showLoading() {
            document.getElementById('results').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('predictionResults').style.display = 'none';
        }

        function displayPredictionResults(data, type) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('predictionResults').style.display = 'block';

            const resultsDiv = document.getElementById('predictionResults');

            resultsDiv.innerHTML = `
                <h2>üìä Predi√ß√£o ${type}</h2>

                <div class="prediction-card">
                    <h3>üèÜ Resultado do Jogo</h3>
                    <div>
                        <strong>Casa:</strong> ${(data.match_outcome.home_win_probability * 100).toFixed(1)}%
                        <div class="probability-bar">
                            <div class="probability-fill" style="width: ${data.match_outcome.home_win_probability * 100}%"></div>
                        </div>
                    </div>
                    <div>
                        <strong>Empate:</strong> ${(data.match_outcome.draw_probability * 100).toFixed(1)}%
                        <div class="probability-bar">
                            <div class="probability-fill" style="width: ${data.match_outcome.draw_probability * 100}%"></div>
                        </div>
                    </div>
                    <div>
                        <strong>Fora:</strong> ${(data.match_outcome.away_win_probability * 100).toFixed(1)}%
                        <div class="probability-bar">
                            <div class="probability-fill" style="width: ${data.match_outcome.away_win_probability * 100}%"></div>
                        </div>
                    </div>
                    <p><strong>Predi√ß√£o:</strong> ${data.match_outcome.predicted_outcome === '1' ? 'Vit√≥ria Casa' : data.match_outcome.predicted_outcome === 'X' ? 'Empate' : 'Vit√≥ria Fora'}</p>
                </div>

                <div class="prediction-card">
                    <h3>‚öΩ Predi√ß√£o de Gols</h3>
                    <p><strong>Gols Esperados Casa:</strong> ${data.goals_prediction.expected_home_goals}</p>
                    <p><strong>Gols Esperados Fora:</strong> ${data.goals_prediction.expected_away_goals}</p>
                    <p><strong>Total de Gols:</strong> ${data.goals_prediction.expected_total_goals}</p>
                    <p><strong>Over 2.5:</strong> ${(data.goals_prediction.over_2_5_probability * 100).toFixed(1)}%</p>
                    <p><strong>Under 2.5:</strong> ${(data.goals_prediction.under_2_5_probability * 100).toFixed(1)}%</p>
                </div>

                <div class="prediction-card">
                    <h3>üéØ Both Teams to Score (BTTS)</h3>
                    <p><strong>BTTS Sim:</strong> ${(data.btts_prediction.btts_yes_probability * 100).toFixed(1)}%</p>
                    <p><strong>BTTS N√£o:</strong> ${(data.btts_prediction.btts_no_probability * 100).toFixed(1)}%</p>
                    <p><strong>Predi√ß√£o:</strong> ${data.btts_prediction.predicted_outcome}</p>
                </div>

                <div class="prediction-card">
                    <h3>üìä Sistema de Confian√ßa</h3>
                    <p><strong>Confian√ßa Geral:</strong> ${(data.confidence_system.overall_confidence * 100).toFixed(1)}%
                    <span class="confidence-badge confidence-${data.confidence_system.confidence_level.toLowerCase()}">${data.confidence_system.confidence_level}</span></p>
                    <p><strong>Recomenda√ß√£o:</strong> ${data.confidence_system.recommendation}</p>
                </div>

                <div class="recommendations">
                    ${data.betting_recommendations.map(rec => `
                        <div class="recommendation-card">
                            <h4>${rec.market}</h4>
                            <p><strong>Recomenda√ß√£o:</strong> ${rec.recommendation}</p>
                            <p><strong>Probabilidade:</strong> ${(rec.probability * 100).toFixed(1)}%</p>
                            <p><strong>Confian√ßa:</strong> <span class="confidence-badge confidence-${rec.confidence.toLowerCase()}">${rec.confidence}</span></p>
                            <p><strong>Raz√£o:</strong> ${rec.reasoning}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function displayMLResults(data) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('predictionResults').style.display = 'block';

            const resultsDiv = document.getElementById('predictionResults');

            resultsDiv.innerHTML = `
                <h2>ü§ñ Predi√ß√£o ML Enhanced</h2>

                <div class="prediction-card">
                    <h3>üìä Status do Sistema</h3>
                    <p><strong>Engine:</strong> ${data.engine}</p>
                    <p><strong>Confian√ßa Geral:</strong> ${data.data.confidence.overall}</p>
                    <p><strong>Modelos Treinados:</strong> ${data.data.system_status.models_trained ? 'Sim' : 'N√£o'}</p>
                </div>

                <div class="prediction-card">
                    <h3>üîÆ Predi√ß√µes Matem√°ticas</h3>
                    <p>Utilizando motor matem√°tico avan√ßado com distribui√ß√£o de Poisson</p>
                    <button onclick="displayPredictionResults(${JSON.stringify(data.data.predictions.mathematical_only).replace(/"/g, '&quot;')}, 'Matem√°tica (via ML)')" class="btn">Ver Detalhes</button>
                </div>

                <div class="prediction-card">
                    <h3>üí° Recomenda√ß√µes</h3>
                    ${data.data.recommendations.map(rec => `<p>‚Ä¢ ${rec}</p>`).join('')}
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('predictionResults').style.display = 'block';
            document.getElementById('predictionResults').innerHTML = `
                <div class="prediction-card" style="border-left-color: #e53e3e; background: #fed7d7;">
                    <h3>‚ùå Erro</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        // Teste autom√°tico ao carregar a p√°gina
        window.addEventListener('load', function() {
            console.log('üöÄ Football Analytics Dashboard carregado!');
            console.log('üì° API Base:', API_BASE);
        });
    </script>
</body>
</html>